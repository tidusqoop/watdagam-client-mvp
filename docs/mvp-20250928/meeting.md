# 용어 및 개념 정리
- 담벼락
    - 여러 낙서들이 모여있는 낙서판
    - 담벼락은 특정 장소에 하나씩 등록 될 예정
- 낙서
    - 개별 낙서
    - 내용, 작성자, 작성 날짜 정보를 담고 있음
    - 현재는 텍스트(이모지포함) 전용이지만 사진, 동영상 낙서로 확장할 계획

---

# 지난 번 회의한 내용
## 낙서 및 담벼락 관련
- 낙서 클릭 시 세부 페이지는 없음 (실제 담벼락에 낙서된 것에 세부 페이지란게 존재 하지 않음) 
- 낙서 작성 완료 후, 수정은 없음 (역시, 실제 담벼락에 남긴 내용을 수정하는 것이 없는 것처럼)
- 담벼락에 낙서 겹치는 경우: 그냥 겹침 허용 (나중에 겹치는 것이 어떤지 보고 판단)
    - 이 경우, view 에서 sorting order 는 최신 날짜 일 수록 가장 위로 오도록
- 낙서 크기 관련
    - 미리 정해진 소, 중, 대 사이즈 선택
    - 크기별 글자 수를 제한하는 방식
- 담벼락 크기 관련
    - 일단은 지금 기본 사이즈 고정 방식
    - 나중에 확장할 수 있는 기능 (담벼락 오너라는 개념을 만들고 관리자가 늘릴 수 있도록)

## 하단 툴바 관련
- 현재 메뉴: 낙서추가, 확대, 축소, 중앙이동
- 변경 메뉴: 낙서추가, 확대, 축소, 새로고침(서벼 연동시 현재 담벼락 새로 고침)

## 담벼락 진입하는 UI 관련 (지도)
- 지도 기반에 각 위치에 미리 설정 되어있는 담벼락이 보임 (아이콘 형태)
- 지도와 함께 담벼락 리스트가 보이는 UI 추가
    - 해당 리스트는 내가 이미 낙서를 남긴 담벼락, 현재 지도에 보이는 담벼락 리스트를 보여줌
- 담벼락 진입 가능한 조건
    - 내가 이미 낙서를 남긴 담벼락
    - 혹은 현재 내 위치(지도) 기준 가까운 담벼락

# 지난번 작업 완료 사항

지난번 MVP 기간 동안 docs/mvp-20250921/ 문서를 기준으로 다음과 같이 구현이 완료되었습니다:

## ✅ 완성된 기능들

### 아키텍처 리팩토링 완료
- **Clean Architecture 도입**: Feature-based 구조로 전면 리팩토링
- **모듈화**: lib/features/graffiti_board/ 구조로 관심사 분리
- **의존성 주입**: Repository 패턴으로 데이터 레이어 추상화
- **확장 가능한 구조**: 새로운 기능 추가를 위한 확장성 확보

### 핵심 UI/UX 개선
- **모눈종이 배경**: GridPainter로 실제 낙서벽 느낌 구현
- **점선 테두리**: DottedBorder 패키지로 낙서 노트 스타일 적용
- **향상된 드래그 앤 드롭**: OptimizedDragHandler로 부드러운 조작
- **줌 컨트롤**: EnhancedTransformationController로 정밀한 확대/축소

### 새로운 낙서 추가 플로우 완성
- **더블 탭 생성**: 캔버스 더블 탭으로 즉시 낙서 생성
- **위치 조정 모드**: 2단계 플로우 (내용 작성 → 위치 조정)
- **TempGraffitiNote**: 임시 낙서 데이터 모델로 플로우 관리
- **RelativeDragPositioningMode**: 정밀한 위치 조정 UI

### 데이터 계층 완전 구현
- **Repository Pattern**: GraffitiRepository 추상화 완료
- **DataSource Factory**: Mock/API 데이터소스 팩토리 패턴
- **JSON Mock Data**: 개발용 샘플 데이터 시스템
- **Environment Config**: AppConfig로 환경별 설정 관리

### 공통 컴포넌트 라이브러리
- **Color Utils**: 색상 계산 및 대비 유틸리티
- **Coordinate Utils**: 좌표 변환 및 경계 처리
- **Time Utils**: 상대 시간 표시 (예: "3일 전")
- **Canvas Constants**: 캔버스 크기 및 설정 상수화

### 위젯 모듈화
- **GraffitiNoteWidget**: 개별 낙서 노트 컴포넌트
- **GraffitiCanvas**: 메인 캔버스 위젯
- **BottomToolbar**: 하단 도구 모음
- **ZoomIndicator**: 확대/축소 수준 표시기

## ✅ 기술적 성과

### 성능 최적화
- **지연 업데이트**: 드래그 중 200ms 지연으로 성능 향상
- **좌표 변환 최적화**: 월드/스크린 좌표 정확한 변환
- **메모리 관리**: 컨트롤러 및 리스너 적절한 dispose

### 코드 품질
- **타입 안전성**: 모든 모델에 강타입 적용
- **에러 처리**: Repository 레벨 예외 처리
- **테스트 준비**: 의존성 주입으로 테스트 가능한 구조

### 개발 경험
- **Hot Reload 최적화**: 위젯 분리로 빠른 개발 사이클
- **Debug 도구**: AppConfig.enableDebugLogging 플래그
- **환경 분리**: Development/Production 환경 설정

## 📊 구현 완료도

| 영역 | 완료도 | 상태 |
|------|--------|------|
| 아키텍처 | 95% | ✅ 완료 |
| 핵심 UI | 90% | ✅ 완료 |
| 낙서 추가 플로우 | 85% | ✅ 완료 |
| 데이터 계층 | 100% | ✅ 완료 |
| 성능 최적화 | 80% | ✅ 완료 |

지난번 MVP에서 설정한 목표들이 거의 모두 달성되어, 안정적이고 확장 가능한 기반이 마련되었습니다.

---

# 다음 MVP 목표

## 🎯 구현 우선순위 및 상세 요건

### Phase 1: 데이터 기반 구조 (우선순위: 최고)
**예상 기간**: 2-3일 | **위험도**: 낮음 | **의존성**: 없음

#### 1.1 사용자 식별 시스템
- **낙서에 user_id 식별자 추가** (Mock 데이터 활용)
- User 모델 생성: `id`, `name`, `avatar` 필드
- "내 낙서" vs "다른 사람 낙서" 구분 로직 구현
- Mock 사용자 데이터 생성 및 현재 사용자 설정

#### 1.2 담벼락 데이터 모델 정의
- **Wall 엔티티 생성**: `id`, `name`, `location`(lat, lng), `description`
- 담벼락 메타데이터: `creation_date`, `max_capacity`, `status`
- Mock 담벼락 데이터 생성 (서울 주요 관광지 기준)

#### 1.3 데이터 관계 설정
- **GraffitiNote belongs to Wall** 관계 구현
- **User creates GraffitiNotes** 관계 구현
- Repository 패턴에 Wall 관련 메서드 추가
- 담벼락별 낙서 필터링 로직 구현

---

### Phase 2: 담벼락 화면 기능 강화 (우선순위: 중간)
**예상 기간**: 4-5일 | **위험도**: 중간 | **의존성**: Phase 1 완료

#### 2.1 낙서 크기 선택 기능 (Quick Win)
- **소/중/대 크기 옵션** 제공
- 크기별 글자 수 제한: 소(50자), 중(100자), 대(200자)
- 낙서 생성 다이얼로그에 크기 선택 UI 추가
- 크기에 따른 visual styling 차별화

#### 2.2 하단 툴바 정리 (Quick Win)
- **메뉴 재구성**: 낙서추가, 확대, 축소, 새로고침
- "중앙이동" 제거, "새로고침" 추가 (기능 없이 버튼만)
- 아이콘 디자인 개선 및 레이아웃 최적화

#### 2.3 위치 조정 정확도 개선
- 드래그 앤 드롭 precision 향상
- 위치 조정 중 visual feedback 강화
- 선택적 snap-to-grid 기능 고려

#### 2.4 사진 기능 추가 (복잡도 높음)
- **로컬 저장 방식**: 이미지 파일 로컬 저장
- GraffitiNote 모델에 `image_path` 필드 추가
- 카메라/갤러리 picker 연동 (`image_picker` 패키지)
- 담벼락 화면에서 적절한 크기로 표시 (자동 크롭/리사이즈)
- 이미지와 텍스트 혼합 표시 UI 구현

---

### Phase 3: 지도 화면 및 내비게이션 (우선순위: 낮음)
**예상 기간**: 5-7일 | **위험도**: 높음 | **의존성**: Phase 1 완료

#### 3.1 지도 시스템 구축
- **지도 라이브러리**: `flutter_map` (초보자 친화적, 무료)
- **위치 권한**: 필수 권한으로 설정
- 현재 위치 감지 및 지도 중심 설정
- 담벼락 위치 마커 표시

#### 3.2 담벼락 진입 권한 로직
- **진입 조건**: 3km 이내 근접 또는 이전 방문 이력
- 거리 계산 로직 구현 (하드코딩 방식)
- 진입 가능/불가능 상태 표시

#### 3.3 담벼락 리스트 UI (추천: Hybrid 방식)
- **상단**: 최근 방문한 담벼락 Card 슬라이더 (최대 3개)
- **하단**: 전체 담벼락 ListView (이름, 거리, 방문여부 표시)
- 필터 버튼: "근처", "방문함", "전체"
- 담벼락 선택 → 담벼락 화면 이동

#### 3.4 앱 진입점 변경
- **첫 화면**: 지도 화면으로 변경
- 내비게이션 플로우: 지도 → 담벼락 선택 → 담벼락 화면
- 뒤로가기 및 상태 관리 구현

---

## 📋 기술적 결정사항 (확정)

### 개발 설정
- **이미지 저장**: 로컬 저장만 활용 (서버 연동 미고려)
- **지도 라이브러리**: flutter_map (접근성, 수정 용이성 우선)
- **위치 권한**: 필수 권한
- **진입 권한 거리**: 3km (하드코딩)

### UI/UX 설정
- **사진 크기 제한**: 없음 (담벼락 화면 최적화 크롭 적용)
- **새로고침 기능**: 버튼만 구현 (실제 기능 없음)
- **담벼락 리스트**: Hybrid Card + List 방식

---

## 🚀 개발 로드맵

| Phase | 기간 | 핵심 기능 | 완료 기준 |
|-------|------|-----------|-----------|
| **Phase 1** | 2-3일 | 데이터 모델 & 관계 | User/Wall 모델 완성, Mock 데이터 연동 |
| **Phase 2** | 4-5일 | 담벼락 화면 강화 | 크기선택, 사진기능, 툴바 개선 |
| **Phase 3** | 5-7일 | 지도 & 내비게이션 | 지도 진입, 담벼락 선택, 권한 로직 |

**총 예상 기간**: 11-15일